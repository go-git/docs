<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://go-git.github.io/docs/tutorials/advanced-usage/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Advanced Usage - go-git Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Advanced Usage";
        var mkdocs_page_input_path = "tutorials/advanced-usage.md";
        var mkdocs_page_url = "/docs/tutorials/advanced-usage/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> go-git Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started/">Getting Started</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Advanced Usage</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#performance-optimizations">Performance Optimizations</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#reduce-the-amount-of-data-being-cloned">Reduce the amount of data being cloned</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#storage-optimization">Storage Optimization</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sha1">SHA1</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#in-memory-repositories">In-memory repositories</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#clone-in-between-repositories-held-in-memory">Clone in between repositories held in memory</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../migrating-from-v5-to-v6/">Migrating to V6</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Concepts</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/overview/">Overview</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">go-git Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tutorials</li>
      <li class="breadcrumb-item active">Advanced Usage</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/go-git/docs/edit/master/docs/tutorials/advanced-usage.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="advanced-usage-of-go-git">Advanced Usage of go-git</h1>
<p>This guide covers advanced usage patterns and performance considerations
when working with go-git.</p>
<h2 id="performance-optimizations">Performance Optimizations</h2>
<p>When working with large repositories or performing intensive operations,
consider the following performance tips:</p>
<h3 id="reduce-the-amount-of-data-being-cloned">Reduce the amount of data being cloned</h3>
<ul>
<li>Shallow clones with setting depth to 1.</li>
<li>Use Sparse Checkout for only representing part of the repository tree
in the Worktree.</li>
<li>When no tags are required, use <code>git.NoTags</code>. This will skip the cloning
of tags, and all the objects they point to - which may result in a
significant increase in cloned data.</li>
</ul>
<h3 id="storage-optimization">Storage Optimization</h3>
<ul>
<li>The fastest storage is the memory storage. For very large repositories
make sure there is enough memory available. Used in conjunction with the
filter option can lead to super efficient operations.</li>
</ul>
<h3 id="sha1">SHA1</h3>
<ul>
<li>By default, go-git uses <code>github.com/pjbgf/sha1cd</code> as the SHA1 algorithm.
It introduces collision detection, which results in slower performance.
When only trustworthy servers are used, consider using the native SHA1
implementation with <code>hash.RegisterHash(sha1.New())</code>.</li>
</ul>
<h2 id="in-memory-repositories">In-memory repositories</h2>
<h3 id="clone-in-between-repositories-held-in-memory">Clone in between repositories held in memory</h3>
<p>Here's an example of using a memfs filesystem, which can be used for multiple
repositories. In this case, it can also be used to clone in-between sub-memfs
filesystems which in fact reside on a higher level memfs.</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="c1">// /</span>
<span class="c1">// /target</span>
<span class="c1">// /src</span>
<span class="c1">//  /go-git</span>
<span class="c1">//  /go-billy</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">rootfs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">memfs</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="w">    </span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rootfs</span><span class="p">.</span><span class="nx">Chroot</span><span class="p">(</span><span class="s">&quot;/target&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">src</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rootfs</span><span class="p">.</span><span class="nx">Chroot</span><span class="p">(</span><span class="s">&quot;/src&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">master</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">src</span><span class="p">.</span><span class="nx">Chroot</span><span class="p">(</span><span class="s">&quot;/go-git-master&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">concurrency</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">src</span><span class="p">.</span><span class="nx">Chroot</span><span class="p">(</span><span class="s">&quot;/go-git-concurrency&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// providing a thread-safe memfs enables running the below as go routines</span>
<span class="w">    </span><span class="nx">clone</span><span class="p">(</span><span class="nx">master</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;https://github.com/go-git/go-git&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;master&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">clone</span><span class="p">(</span><span class="nx">concurrency</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;https://github.com/go-git/go-git&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;read-concurrency&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>

<span class="w">    </span><span class="nx">loader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">NewFilesystemLoader</span><span class="p">(</span><span class="nx">rootfs</span><span class="p">)</span>
<span class="w">    </span><span class="nx">client</span><span class="p">.</span><span class="nx">InstallProtocol</span><span class="p">(</span><span class="s">&quot;file&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">NewClient</span><span class="p">(</span><span class="nx">loader</span><span class="p">))</span>

<span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;file:///src/go-git-master&quot;</span>

<span class="w">    </span><span class="nx">dot</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">Chroot</span><span class="p">(</span><span class="s">&quot;.git&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">CheckIfError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

<span class="w">    </span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;git clone %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span>
<span class="w">    </span><span class="nx">storer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filesystem</span><span class="p">.</span><span class="nx">NewStorage</span><span class="p">(</span><span class="nx">dot</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">NewObjectLRUDefault</span><span class="p">())</span>
<span class="w">    </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">git</span><span class="p">.</span><span class="nx">Clone</span><span class="p">(</span><span class="nx">storer</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">git</span><span class="p">.</span><span class="nx">CloneOptions</span><span class="p">{</span>
<span class="w">        </span><span class="nx">URL</span><span class="p">:</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nx">CheckIfError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

<span class="w">    </span><span class="nx">ref</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Head</span><span class="p">()</span>
<span class="w">    </span><span class="nx">CheckIfError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

<span class="w">    </span><span class="nx">commit</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">CommitObject</span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">Hash</span><span class="p">())</span>
<span class="w">    </span><span class="nx">CheckIfError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">commit</span><span class="p">)</span>

<span class="w">    </span><span class="nx">url2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;file:///src/go-git-concurrency&quot;</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Fetch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">git</span><span class="p">.</span><span class="nx">FetchOptions</span><span class="p">{</span>
<span class="w">        </span><span class="nx">RemoteURL</span><span class="p">:</span><span class="w"> </span><span class="nx">url2</span><span class="p">,</span>
<span class="w">        </span><span class="nx">RefSpecs</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">config</span><span class="p">.</span><span class="nx">RefSpec</span><span class="p">{</span>
<span class="w">            </span><span class="o">...</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nx">CheckIfError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">clone</span><span class="p">(</span><span class="nx">fs</span><span class="w"> </span><span class="nx">billy</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">branch</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">storer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filesystem</span><span class="p">.</span><span class="nx">NewStorage</span><span class="p">(</span><span class="nx">fs</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">NewObjectLRUDefault</span><span class="p">())</span>

<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">git</span><span class="p">.</span><span class="nx">Clone</span><span class="p">(</span><span class="nx">storer</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">git</span><span class="p">.</span><span class="nx">CloneOptions</span><span class="p">{</span>
<span class="w">        </span><span class="nx">URL</span><span class="p">:</span><span class="w">           </span><span class="nx">url</span><span class="p">,</span>
<span class="w">        </span><span class="nx">SingleBranch</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ReferenceName</span><span class="p">:</span><span class="w"> </span><span class="nx">plumbing</span><span class="p">.</span><span class="nx">NewBranchReferenceName</span><span class="p">(</span><span class="nx">branch</span><span class="p">),</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>

<span class="w">    </span><span class="nx">CheckIfError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Clone %q from %q: DONE\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">branch</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../getting-started/" class="btn btn-neutral float-left" title="Getting Started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../troubleshooting/" class="btn btn-neutral float-right" title="Troubleshooting">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/go-git/docs" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../getting-started/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../troubleshooting/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
